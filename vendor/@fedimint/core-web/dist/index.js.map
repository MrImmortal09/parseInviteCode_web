{"version":3,"file":"index.js","sources":["../src/utils/logger.ts","../src/worker/WorkerClient.ts","../src/services/MintService.ts","../src/services/BalanceService.ts","../src/services/LightningService.ts","../src/services/RecoveryService.ts","../src/services/FederationService.ts","../src/FedimintWallet.ts"],"sourcesContent":[null,null,null,null,null,null,null,null],"names":["logLevels","logger","constructor","level","this","setLevel","coerceLevel","includes","toLocaleUpperCase","log","message","args","logLevel","shouldLog","consoleFn","console","toUpperCase","debug","info","warn","error","messageLevel","levels","messageLevelIndex","indexOf","WorkerClient","requestCounter","requestCallbacks","Map","initPromise","undefined","worker","Worker","URL","url","type","onmessage","handleWorkerMessage","bind","onerror","handleWorkerError","initialize","sendSingleMessage","handleWorkerLogs","event","data","requestId","streamCallback","get","payload","Promise","resolve","reject","set","response","delete","postMessage","rpcStream","module","method","body","onSuccess","onError","onEnd","unsubscribe","isSubscribed","unsubscribePromise","setTimeout","_rpcStreamInner","then","end","rpcSingle","cleanup","clear","_getRequestCounter","_getRequestCallbackMap","MintService","client","redeemEcash","notes","oob_notes","extra_meta","reissueExternalNotes","oobNotes","extraMeta","subscribeReissueExternalNotes","operationId","operation_id","spendNotes","amountMsats","tryCancelAfter","includeInvite","duration","nanos","secs","res","min_amount","try_cancel_after","include_invite","parseNotes","tryCancelSpendNotes","subscribeSpendNotes","awaitSpendOobRefund","BalanceService","getBalance","subscribeBalance","parseInt","LightningService","createInvoice","description","expiryTime","gatewayInfo","gateway","_getDefaultGatewayInfo","amount","expiry_time","parseInvoice","invoice","createInvoiceTweaked","tweakKey","index","user_key","scanReceivesForTweaks","indices","updateGatewayCache","gateways","listGateways","payInvoice","maybe_gateway","payInvoiceSync","timeoutMs","async","contract_id","fee","subscribeLnPay","clearTimeout","timeoutId","success","feeMsats","preimage","Error","unexpected_error","error_message","subscribeLnClaim","waitForPay","subscribeLnReceive","waitForReceive","getGateway","gatewayId","forceInternal","gateway_id","force_internal","RecoveryService","hasPendingRecoveries","waitForAllRecoveries","subscribeToRecoveryProgress","FederationService","getConfig","getFederationId","getInviteCode","peer","listOperations","DEFAULT_CLIENT_NAME","FedimintWallet","lazy","_openPromise","_resolveOpen","_isOpen","_client","mint","lightning","balance","federation","recovery","waitForOpen","open","clientName","joinFederation","inviteCode","e","parseInviteCode","isOpen","setLogLevel"],"mappings":"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"}