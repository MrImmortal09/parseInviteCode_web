{"version":3,"file":"index.js","sources":["../src/utils/logger.ts","../src/worker/WorkerClient.ts","../src/services/MintService.ts","../src/services/BalanceService.ts","../src/services/LightningService.ts","../src/services/RecoveryService.ts","../src/services/FederationService.ts","../src/FedimintWallet.ts"],"sourcesContent":[null,null,null,null,null,null,null,null],"names":["logLevels","logger","constructor","level","this","setLevel","coerceLevel","includes","toLocaleUpperCase","log","message","args","logLevel","shouldLog","consoleFn","console","toUpperCase","debug","info","warn","error","messageLevel","levels","messageLevelIndex","indexOf","WorkerClient","requestCounter","requestCallbacks","Map","initPromise","undefined","worker","Worker","URL","url","type","onmessage","handleWorkerMessage","bind","onerror","handleWorkerError","initialize","sendSingleMessage","handleWorkerLogs","event","data","requestId","streamCallback","get","payload","Promise","resolve","reject","set","response","delete","postMessage","rpcStream","module","method","body","onSuccess","onError","onEnd","unsubscribe","isSubscribed","unsubscribePromise","setTimeout","_rpcStreamInner","then","end","rpcSingle","cleanup","clear","_getRequestCounter","_getRequestCallbackMap","MintService","client","redeemEcash","notes","oob_notes","extra_meta","reissueExternalNotes","oobNotes","extraMeta","subscribeReissueExternalNotes","operationId","operation_id","spendNotes","amountMsats","tryCancelAfter","includeInvite","duration","nanos","secs","res","min_amount","try_cancel_after","include_invite","parseNotes","tryCancelSpendNotes","subscribeSpendNotes","awaitSpendOobRefund","BalanceService","getBalance","subscribeBalance","parseInt","LightningService","createInvoice","description","expiryTime","gatewayInfo","gateway","_getDefaultGatewayInfo","amount","expiry_time","createInvoiceTweaked","tweakKey","index","user_key","scanReceivesForTweaks","indices","updateGatewayCache","gateways","listGateways","payInvoice","invoice","maybe_gateway","payInvoiceSync","timeoutMs","async","contract_id","fee","subscribeLnPay","clearTimeout","timeoutId","success","feeMsats","preimage","Error","unexpected_error","error_message","subscribeLnClaim","waitForPay","subscribeLnReceive","waitForReceive","getGateway","gatewayId","forceInternal","gateway_id","force_internal","RecoveryService","hasPendingRecoveries","waitForAllRecoveries","subscribeToRecoveryProgress","FederationService","getConfig","getFederationId","getInviteCode","peer","listOperations","DEFAULT_CLIENT_NAME","FedimintWallet","lazy","_openPromise","_resolveOpen","_isOpen","_client","mint","lightning","balance","federation","recovery","waitForOpen","open","clientName","joinFederation","inviteCode","e","isOpen","setLogLevel","parseInviteCode"],"mappings":"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"}